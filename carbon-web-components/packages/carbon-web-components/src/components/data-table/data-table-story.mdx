import { Props, Description } from '@storybook/addon-docs/blocks';
import { cdnJs, cdnCss } from '../../globals/internal/storybook-cdn';

# Data table

> ðŸ’¡ Check our
> [CodeSandbox](https://codesandbox.io/s/github/carbon-design-system/carbon-for-ibm-dotcom/tree/main/packages/carbon-web-components/examples/codesandbox/basic/components/data-table)
> example implementation.

[![Edit carbon-web-components](https://codesandbox.io/static/img/play-codesandbox.svg)](https://codesandbox.io/s/github/carbon-design-system/carbon-for-ibm-dotcom/tree/main/packages/carbon-web-components/examples/codesandbox/basic/components/data-table)

## Getting started

Here's a quick example to get you started.

Data table in `carbon-web-components` focuses on primitives that constructs
table UI, consisting of the following:

| Tag                      | Description     | HTML tag counterpart |
| ------------------------ | --------------- | -------------------- |
| `<cds-data-table>`        | The container   | N/A                  |
| `<cds-table>`             | The table       | `<table>`            |
| `<cds-table-head>`        | The header      | `<thead>`            |
| `<cds-table-header-row>`  | The header row  | `<tr>` in `<thead>`  |
| `<cds-table-header-cell>` | The header cell | `<th>`               |
| `<cds-table-body>`        | The header body | `<tbody>`            |
| `<cds-table-row>`         | The header row  | `<tr>` in `<tbody>`  |
| `<cds-table-cell>`        | The header cell | `<td>`               |

### JS (via import)

```javascript
import '@carbon/web-components/es/components/data-table/index.js';
```

<Description markdown={`${cdnJs({ components: ['data-table'] })}`} />
<Description markdown={`${cdnCss()}`} />

### HTML

```html
<cds-data-table>
  <cds-table>
    <cds-table-head>
      <cds-table-header-row>
        <cds-table-header-cell>Foo</cds-table-header-cell>
        <cds-table-header-cell>Bar</cds-table-header-cell>
        <cds-table-header-cell>Baz</cds-table-header-cell>
      </cds-table-header-row>
    </cds-table-head>
    <cds-table-body>
      <cds-table-row>
        <cds-table-cell>Foo1</cds-table-cell>
        <cds-table-cell>Bar1</cds-table-cell>
        <cds-table-cell>Baz1</cds-table-cell>
      </cds-table-row>
      <cds-table-row>
        <cds-table-cell>Foo2</cds-table-cell>
        <cds-table-cell>Bar2</cds-table-cell>
        <cds-table-cell>Baz2</cds-table-cell>
      </cds-table-row>
      <cds-table-row>
        <cds-table-cell>Foo3</cds-table-cell>
        <cds-table-cell>Bar3</cds-table-cell>
        <cds-table-cell>Baz3</cds-table-cell>
      </cds-table-row>
    </cds-table-body>
  </cds-table>
</cds-data-table>
```

## Row selection

Adding `selection-name` attribute to `<cds-table-row>`/`<cds-table-header-row>`
shows the selection UI in the table row.

The logic of row selection needs to be handled on by the application code. When
user attempts to change row selection, the following events fire:

| Element                 | Event                           | Description                                                   |
| ----------------------- | ------------------------------- | ------------------------------------------------------------- |
| `<cds-table-row>`        | `cds-table-row-change-selection` | Indicates user-initiated change in selection of a single row. |
| `<cds-table-header-row>` | `cds-table-change-selection-all` | Indicates user-initiated change in selection of all rows.     |

Both of above events have the following properties in the event details:

| Property   | Description              |
| ---------- | ------------------------ |
| `selected` | The new selection state. |

Both of above events bubble and are cancelable. Canceling those events mean
canceling change in selection.

Application code should listen to those events update its internal state of
table rows. To do so, it's convenient to add a `data-` attribte to each table
rows so the delegated event handler can see which row the events are from.

Here's an example of [`lit-html`](https://lit-html.polymer-project.org). Note
that those events are native DOM events, and thus something like
`document.addEventListener('cds-table-row-change-selection', event => { ... })`
works, too:

```javascript
/**
 * Handles an event to change in selection of rows, fired from `<cds-table-row>`,
 * to update application's row selection states.
 * @param {CustomEvent} event The event.
 */
const handleChangeSelection = event => {
  if (!event.defaultPrevented) {
    rows = this.rows.map(row => {
      // The row ID you set to `<cds-table-row>` the event is fired on
      const targetRowId = event.target.dataset.rowId;
      return targetRowId !== row.id
        ? row
        : {
            ...row,
            selected: event.detail.selected,
          };
    });
  }
};

/**
 * Handles an event to change in selection of all rows, fired from `<cds-table-header-row>`,
 * to update application's row selection states.
 * @param {CustomEvent} event The event.
 */
const handleChangeSelectionAll = event => {
  if (!event.defaultPrevented) {
    rows = this.rows.map(row => ({
      ...row,
      selected: event.detail.selected,
    }));
  }
};

...

html`
  <cds-data-table
    @cds-table-row-change-selection=${handleChangeSelection}
    @cds-table-change-selection-all=${handleChangeSelectionAll}
  >
    <cds-table>
      <cds-table-head>
        <cds-table-header-row ?selected=${rows.every(row => row.selected)} selection-name="my-row-selection-all">
          <cds-table-header-cell>Foo</cds-table-header-cell>
          <cds-table-header-cell>Bar</cds-table-header-cell>
          <cds-table-header-cell>Baz</cds-table-header-cell>
        </cds-table-header-row>
      </cds-table-head>
      <cds-table-body>
        ${rows.map(
          row => html`
            <cds-table-row ?selected=${row.selected} selection-name="${`my-row-selection-${row.id}`}" data-row-id="${row.id}">
              <cds-table-cell>${row.foo}</cds-table-cell>
              <cds-table-cell>${row.bar}</cds-table-cell>
              <cds-table-cell>${row.baz}</cds-table-cell>
            </cds-table-row>
          `
        )}
      </cds-table-body>
    </cds-table>
  </cds-data-table>
`;
```

## Sorting

Adding `sort-direction` attribute to `<cds-table-header-cell>` shows the sorting
UI in the table header cell.

The logic of sorting needs to be handled on by the application code. When user
attempts to change sorting, `cds-table-header-cell-sort` event is fired, with the
following properties in the event details:

| Property           | Description             |
| ------------------ | ----------------------- |
| `oldSortDirection` | The old sort direction. |
| `sortDirection`    | The new sort direction. |

`cds-table-header-cell-sort` event bubbles and is cancelable. Canceling
`cds-table-header-cell-sort` event means canceling change in sort direction.

Application code should listen to those events update its internal state of
sorting. An example of the logic needed is available in our codesandbox example
above. To do so, it's convenient to add a `data-` attribte to each table header
cells so the delegated event handler can see which table column the events are
from.

Here's an example of [`lit-html`](https://lit-html.polymer-project.org). Note
that those events are native DOM events, and thus something like
`document.addEventListener('cds-table-header-cell-sort', event => { ... })`
works, too:

```javascript
/**
 * Handles an event to sort rows, fired from `<cds-table-header-cell>`, to update application's sorting state.
 * @param {CustomEvent} event The event.
 */
const handleChangeSort = event => {
  if (!defaultPrevented) {
    // Changes the sorting state upon user gesture
    sortInfo = {
      columnId: event.target.dataset.columnId,
      direction: event.detail.direction,
    };
  }
};

...

const collator = new Intl.Collator('en'); // Use the locale user is on

/**
 * Rows sorted by application's sorting state.
 */
const sortedRows = rows.slice().sort((lhs, rhs) => {
  const lhsValue = lhs[sortInfo.columnId];
  const rhsValue = rhs[sortInfo.columnId];
  return (sortInfo.direction === 'ascending' ? 1 : -1) * collator.compare(lhsValue, rhsValue);
});

html`
  <cds-data-table
    @cds-table-header-cell-sort=${handleChangeSort}
  >
    <cds-table>
      <cds-table-head>
        <cds-table-header-row>
          <cds-table-header-cell data-column-id="foo">Foo</cds-table-header-cell>
          <cds-table-header-cell data-column-id="bar">Bar</cds-table-header-cell>
          <cds-table-header-cell data-column-id="baz">Baz</cds-table-header-cell>
        </cds-table-header-row>
      </cds-table-head>
      <cds-table-body>
        ${sortedRows.map(
          row => html`
            <cds-table-row>
              <cds-table-cell>${row.foo}</cds-table-cell>
              <cds-table-cell>${row.bar}</cds-table-cell>
              <cds-table-cell>${row.baz}</cds-table-cell>
            </cds-table-row>
          `
        )}
      </cds-table-body>
    </cds-table>
  </cds-data-table>
`;
```

## Skeleton

For the skeleton variation, utilize `<cds-table-header-cell-skeleton>`.

```html
<cds-table size="short">
  <cds-table-head>
    <cds-table-header-row>
      <cds-table-header-cell-skeleton>Name</cds-table-header-cell-skeleton>
      <cds-table-header-cell-skeleton>Protocol</cds-table-header-cell-skeleton>
      <cds-table-header-cell-skeleton>Port</cds-table-header-cell-skeleton>
      <cds-table-header-cell-skeleton>Rule</cds-table-header-cell-skeleton>
      <cds-table-header-cell-skeleton
        >Attached Groups</cds-table-header-cell-skeleton
      >
      <cds-table-header-cell-skeleton>Status</cds-table-header-cell-skeleton>
    </cds-table-header-row>
  </cds-table-head>
  <cds-table-body color-scheme="zebra">
    <cds-table-row>
      <cds-table-cell-skeleton></cds-table-cell-skeleton>
      <cds-table-cell-skeleton></cds-table-cell-skeleton>
      <cds-table-cell-skeleton></cds-table-cell-skeleton>
      <cds-table-cell-skeleton></cds-table-cell-skeleton>
      <cds-table-cell-skeleton></cds-table-cell-skeleton>
      <cds-table-cell-skeleton></cds-table-cell-skeleton>
    </cds-table-row>
    <cds-table-row>
      <cds-table-cell></cds-table-cell>
      <cds-table-cell></cds-table-cell>
      <cds-table-cell></cds-table-cell>
      <cds-table-cell></cds-table-cell>
      <cds-table-cell></cds-table-cell>
      <cds-table-cell></cds-table-cell>
    </cds-table-row>
    <cds-table-row>
      <cds-table-cell></cds-table-cell>
      <cds-table-cell></cds-table-cell>
      <cds-table-cell></cds-table-cell>
      <cds-table-cell></cds-table-cell>
      <cds-table-cell></cds-table-cell>
      <cds-table-cell></cds-table-cell>
    </cds-table-row>
  </cds-table-body>
</cds-table>
```

## Attributes, properties and events

Note: For `boolean` attributes, `true` means simply setting the attribute (e.g.
`<cds-table sort>`) and `false` means not setting the attribute (e.g.
`<cds-table>` without `sort` attribute).

### `<cds-table>`

<Props of="cds-table" />

### `<cds-table-header-row>`

<Props of="cds-table-header-row" />

### `<cds-table-header-cell>`

<Props of="cds-table-header-cell" />

### `<cds-table-body>`

<Props of="cds-table-body" />

### `<cds-table-row>`

<Props of="cds-table-row" />

### `<cds-table-batch-actions>`

<Props of="cds-table-batch-actions" />

### `<cds-table-toolbar-content>`

<Props of="cds-table-toolbar-content" />

### `<cds-table-toolbar-search>`

<Props of="cds-table-toolbar-search" />
