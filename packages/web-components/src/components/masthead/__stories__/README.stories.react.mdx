import {
  Preview,
  Props,
  Description,
  Story,
} from '@storybook/addon-docs/blocks';
import contributing from '../../../../../../docs/contributing-license.md';
import { PropTypesRef } from '@carbon/ibmdotcom-web-components/es/components-react/masthead/masthead-composite.js';

# Masthead

> The masthead component is a required navigational pattern for IBM.com that
> displays consistently at the top of each page. It also includes search and
> profile services for IBM.com.

> ðŸ’¡ Check our
> [Stackblitz](https://stackblitz.com/github/carbon-design-system/carbon-for-ibm-dotcom/tree/main/packages/web-components/examples/stackblitz/components-react/masthead)
> example implementation.

### Masthead (L0):

[![Edit @carbon/ibmdotcom-web-components](https://developer.stackblitz.com/img/open_in_stackblitz.svg)](https://stackblitz.com/github/carbon-design-system/carbon-for-ibm-dotcom/tree/main/packages/web-components/examples/stackblitz/components-react/masthead)

### Masthead (L1):

[![Edit @carbon/ibmdotcom-web-components](https://developer.stackblitz.com/img/open_in_stackblitz.svg)](https://stackblitz.com/github/carbon-design-system/carbon-for-ibm-dotcom/tree/main/packages/web-components/examples/stackblitz/components-react/masthead-l1)

## Getting Started

##### Note: Masthead uses the Carbon White theme by design. Using other themes will not change the Masthead color scheme.

### JS

```javascript
import C4DMastheadContainer from '@carbon/ibmdotcom-web-components/es/components-react/masthead/masthead-container.js';

function App() {
  return <C4DMastheadContainer></C4DMastheadContainer>;
}
```

#### Setting Platform

```javascript
function App() {
  return <C4DMastheadContainer platform="Lorem ipsum"></C4DMastheadContainer>;
}
```

#### Setting Platform URL

The `platformUrl` property accepts a single URL as string or an object with a
specific URL for each locale. This property has to be set via javascript.

###### Setting a single platform URL:

```javascript
function App() {
  return (
    <C4DMastheadContainer
      platform="Lorem ipsum"
      id="masthead-container"></C4DMastheadContainer>
  );
}
```

```javascript
const singleUrl = 'https://www.example.com';

document.getElementById('masthead-container').platformUrl = singleUrl;
```

###### Setting multiple platform URLs with an object:

With an object, the component will show a specific URL depending on the locale:

```javascript
const urlObject = {
  'en-US': {
    url: 'https://www.example.com',
  },
  'fr-FR': {
    url: 'https://www.example.com/fr-fr/sample',
  },
  'es-MX': {
    url: 'https://www.example.com/es-mx/sample',
  },
};

document.getElementById('masthead-container').platformUrl = urlObject;
```

```javascript
function App() {
  return (
    <C4DMastheadContainer
      platform="Lorem ipsum"
      id="masthead-container"></C4DMastheadContainer>
  );
}
```

#### Custom Navigation

In order to set custom navigation for the masthead, set the custom navigation
data to the `customNavLinks` property of the masthead-container component.

```javascript
const links = [...menu items...];
document.getElementById('masthead-container').customNavLinks = links;
```

#### Using L1 nav

To use L1 nav, set `l1Data` prop. `l1Data` prop should be an object that
contains the navigation data of L1 nav:

```javascipt
const l1Data = {
  platform: {
    name: 'Stock Charts',
    url: 'https://example.com/',
  },
  menuItems: (The nav links),
}
```

```javascript
function App() {
  return <C4DMastheadContainer id="masthead-container"></C4DMastheadContainer>;
}
```

To set a custom endpoint for the translation service to fetch from, set either
the `data-endpoint` attribute like below or `C4D_TRANSLATION_ENDPOINT`
environment variable.

```javascript
function App() {
  return (
    <C4DMastheadContainer data-endpoint="/custom-endpoint"></C4DMastheadContainer>
  );
}
```

### Setting the active menu item

The active menu item receives a unique style treatment to indicate where the
current page is within the navigation hierarchy.

##### Manually

Manually set the active item by using the `selected-menu-item` property. See
[the Props table](#props).

##### Automatically

The first menu item whose `href` value matches the browser window's current URL
will automatically be marked active if the `selected-menu-item` property has not
been set.

If no other menu items are marked active and the optional `platformUrl` property
has been set, the platform link will be marked active.

## Using custom search with typeahead API

Using a search API other than the default provided from IBM Search is supported.

First, add the `custom-typeahead-api` attribute into the masthead and set it to
`true`.

```javascript
function App() {
  return (
    <C4DMastheadContainer custom-typeahead-api="true"></C4DMastheadContainer>
  );
}

async function customTypeaheadApiFunction(searchVal) {
  return fetch(
    `https://ibmdocs-dev.mybluemix.net/docs/api/v1/suggest?query=${searchVal}&lang=en&categories=&limit=6`
  )
    .then((response) => response.json())
    .then((data) => {
      let searchResults = [data.hints];
      return searchResults;
    });
}
```

To query the current masthead search input, we need to create an event listener
to listen for the `cds-search-with-typeahead-input` event. Once captured, we
need to call our asynchronous function to fetch the custom API results based on
the query. Once the results are retrieved, a new custom event
`cds-custom-typeahead-api-results` needs to be dispatched containing the results
for the component to render the search suggestions.

```javascript
document.addEventListener('cds-search-with-typeahead-input', async (e) => {
  const results = await customTypeaheadApiFunction(e.detail.value);
  document.dispatchEvent(
    new CustomEvent('cds-custom-typeahead-api-results', { detail: results })
  );
});
```

### Grouped Search

Some APIs contain grouped results in addition to regular search suggestions,
which can also be displayed upon search.

As before, create a function that fetches the query and make sure to include a
JSON object containing the section's `title` and the array of retrieved section
suggestions in `items`. In the example below, the section `Product pages` is
added to the results array.

```javascript
async function customTypeaheadApiFunction(searchVal) {
  return fetch(
    `https://ibmdocs-dev.mybluemix.net/docs/api/v1/suggest?query=${searchVal}&lang=en&categories=&limit=6`
  )
    .then((response) => response.json())
    .then((data) => {
      let searchResults = [
        data.hints,

        // optional category results fetched from API
        {
          title: 'Product pages',
          items: data.products,
        },
      ];
      return searchResults;
    });
}
```

As mentioned above, the two events `cds-search-with-typeahead-input` and
`cds-custom-typeahead-api-results` must be handled for suggestions to be
rendered -- the same code for the event listener can be reused.

#### Note

The API results must match the following structure:

```javascript
[
  ['result 1', 'result 2', 'result 3'],
  {
    title: 'Example group 1'
    items: ['result a', 'result b', 'result c']
  },
  {
    title: "Example group 2",
    items: ['result d', 'result e', 'result f']
  }
]
```

Note that only the first array element is necessary to render the basic search
suggestions, the following JSON objects are optional Grouped sections.

## Scoped search

Scoped searches are also supported, returning results from specifically targeted
IBM pages and products.

First, prepare the desired categories to use when scoping the search. In this
example, we will be creating an array with four categories, which must follow
the structure below:

```javascript
const scopeParameters = [
  {
    name: 'All',
    appId: 'all',
    value: 'all',
  },
  {
    name: 'Analyst',
    appId: 'analyst',
    value: 'analyst'
  },
  {
    name: 'PartnerWorld',
    appId: 'pw',
    value: ['pw', 'pwp'],
  },
  {
    name: 'Developer',
    appId: 'dw',
    value: ['dw', 'dwaspera'],
  },
  {
    name: 'IBM Docs',
    appId: 'ibmdocs',
    value: ['ibmdocs', 'dw']
    label: 'Search Label', // optional
  }
];
```

#### Note

A list of the available scoped categories can be found
[here](https://github.ibm.com/digital-marketplace/columbus/blob/master/docs/SCOPED.MD).

The `value` property can either be a single string, or an array of strings.

This array will be passed into the `scopeParameters` property. If using
`lit-html` to render your page, this can be added using `.scopeParameters` (note
the `.`), in order for the array to be processed properly in the component.

```javascript
function App() {
  return (
    <C4DMastheadContainer
      scopeParameters={scopeParameters}></C4DMastheadContainer>
  );
}
```

Alternatively, JavaScript can be used to insert it into the component.

```javascript
document.querySelector('cds-masthead-composite').scopeParameters =
  scopeParameters;
```

If a different locale is used, it will be necessary to use a formatter function
to localize the placeholder text that will be rendered depending on the selected
scope.

```javascript
const placeholderFormatter = ({ scopeValue }) => `Buscar en ${scopeValue}`;
document.querySelector('cds-search-with-typeahead').placeholderFormatter =
  placeholderFormatter;
```

## Props

<Props of={PropTypesRef} />

[cds-masthead-container props](https://carbon-design-system.github.io/carbon-for-ibm-dotcom/canary/web-components/?path=/docs/components-masthead--with-alternate-logo-and-tooltip#props)

For Cloud-specific version of masthead-container,
`<c4d-cloud-masthead-container>`, we support two user authentication methods,
via cookie or api. To select between the two, provide the `auth-method` prop
with a value of either 'cookie' or 'api'.

```javascript
function App() {
  return <C4DMastheadContainer auth-method="cookie"></C4DMastheadContainer>;
}
```

## Stable selectors

See
[our README](https://github.com/carbon-design-system/carbon-for-ibm-dotcom/tree/main/packages/web-components#stable-selectors-for-analytics-and-integratione2e-testing-in-web-components)
to see how Web Components selector and `data-autoid` should be used.

| Web Components selector                                                                   | Compatibility selector                                                   | Description |
| ----------------------------------------------------------------------------------------- | ------------------------------------------------------------------------ | ----------- |
| `<c4d-masthead>`                                                                          | `data-autoid="c4d--masthead"`                                            | Component   |
| `<c4d-masthead-menu-button>`                                                              | `data-autoid="c4d--masthead__hamburger"`                                 | Interactive |
| `<c4d-top-nav-name>`                                                                      | `data-autoid="c4d--masthead__platform-name"`                             | Interactive |
| `<c4d-top-nav>`                                                                           | `data-autoid="c4d--masthead__l0-nav"`                                    | Component   |
| `<c4d-top-nav-menu trigger-content="${item}">` and `<c4d-top-nav-item title="${item}">`   | `data-autoid="c4d--masthead__l0-nav--nav${item}"`                        | Interactive |
| `<c4d-top-nav-menu-item title="${item}">`                                                 | `data-autoid="c4d--masthead__l0-nav--subnav-col${item}-item${item}"`     | Interactive |
| `<c4d-left-nav>`                                                                          | `data-autoid="c4d--masthead__l0-sidenav"`                                | Component   |
| `<c4d-left-nav-menu trigger-content="${item}">`                                           | `data-autoid="c4d--masthead__l0-sidenav--nav${item}"`                    | Interactive |
| `<c4d-left-nav-menu-item title="${item}">`                                                | `data-autoid="c4d--masthead__l0-sidenav--subnav-col${item}-item${item}"` | Interactive |

<Description markdown={contributing} />
