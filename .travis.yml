language: node_js
node_js:
  - "10"
cache: yarn
jobs:
  include:
    - stage: deploy-preview-expressive
      env:
        - COS_BUCKET=carbon-expressive
        - PACKAGE_NAME=styles
        - PACKAGE_FOLDER=styles
        - BUILD_TYPE=storybook
      before_install:
        - ./.travis/deploy_preview_before_install.sh ${TRAVIS_PULL_REQUEST} ${TRAVIS_REPO_SLUG} ${PACKAGE_NAME} ${COS_ACCESS_KEY_ID} ${COS_SECRET_ACCESS_KEY} || travis_terminate 0
      script:
        - ./.travis/deploy_preview_build.sh ${BUILD_TYPE} ${PACKAGE_FOLDER} ${COS_BUCKET} ${TRAVIS_PULL_REQUEST} ${PREVIEW_DOMAIN}
      after_success:
        - "node ./.travis/deploy_preview_comment.js ${GITHUB_TOKEN} 'Carbon Expressive' ${COS_BUCKET} ${PREVIEW_DOMAIN} ${TRAVIS_PULL_REQUEST} ${TRAVIS_PULL_REQUEST_SHA} ${TRAVIS_REPO_SLUG}"
    - stage: deploy-preview-patterns-react
      env:
        - COS_BUCKET=ibmdotcom-patterns-react
        - PACKAGE_NAME=patterns
        - PACKAGE_FOLDER=patterns-react
        - BUILD_TYPE=storybook
      before_install:
        - ./.travis/deploy_preview_before_install.sh ${TRAVIS_PULL_REQUEST} ${TRAVIS_REPO_SLUG} ${PACKAGE_NAME} ${COS_ACCESS_KEY_ID} ${COS_SECRET_ACCESS_KEY} || travis_terminate 0
      script:
        - ./.travis/deploy_preview_build.sh ${BUILD_TYPE} ${PACKAGE_FOLDER} ${COS_BUCKET} ${TRAVIS_PULL_REQUEST} ${PREVIEW_DOMAIN}
      after_success:
        - "node ./.travis/deploy_preview_comment.js ${GITHUB_TOKEN} 'Patterns React' ${COS_BUCKET} ${PREVIEW_DOMAIN} ${TRAVIS_PULL_REQUEST} ${TRAVIS_PULL_REQUEST_SHA} ${TRAVIS_REPO_SLUG}"
    - stage: deploy-preview-patterns-react-experimental
      env:
        - COS_BUCKET=ibmdotcom-patterns-react-experimental
        - PACKAGE_NAME=patterns
        - PACKAGE_FOLDER=patterns-react
        - BUILD_TYPE=storybook-experimental
      before_install:
        - ./.travis/deploy_preview_before_install.sh ${TRAVIS_PULL_REQUEST} ${TRAVIS_REPO_SLUG} ${PACKAGE_NAME} ${COS_ACCESS_KEY_ID} ${COS_SECRET_ACCESS_KEY} || travis_terminate 0
      script:
        - ./.travis/deploy_preview_build.sh ${BUILD_TYPE} ${PACKAGE_FOLDER} ${COS_BUCKET} ${TRAVIS_PULL_REQUEST} ${PREVIEW_DOMAIN}
      after_success:
        - "node ./.travis/deploy_preview_comment.js ${GITHUB_TOKEN} 'Patterns React - Experimental' ${COS_BUCKET} ${PREVIEW_DOMAIN} ${TRAVIS_PULL_REQUEST} ${TRAVIS_PULL_REQUEST_SHA} ${TRAVIS_REPO_SLUG}"
    - stage: deploy-preview-react
      env:
        - COS_BUCKET=ibmdotcom-react
        - PACKAGE_NAME=react
        - PACKAGE_FOLDER=react
        - BUILD_TYPE=storybook
      before_install:
        - ./.travis/deploy_preview_before_install.sh ${TRAVIS_PULL_REQUEST} ${TRAVIS_REPO_SLUG} ${PACKAGE_NAME} ${COS_ACCESS_KEY_ID} ${COS_SECRET_ACCESS_KEY} || travis_terminate 0
      script:
        - ./.travis/deploy_preview_build.sh ${BUILD_TYPE} ${PACKAGE_FOLDER} ${COS_BUCKET} ${TRAVIS_PULL_REQUEST} ${PREVIEW_DOMAIN}
      after_success:
        - "node ./.travis/deploy_preview_comment.js ${GITHUB_TOKEN} 'React' ${COS_BUCKET} ${PREVIEW_DOMAIN} ${TRAVIS_PULL_REQUEST} ${TRAVIS_PULL_REQUEST_SHA} ${TRAVIS_REPO_SLUG}"
    - stage: deploy-preview-react-experimental
      env:
        - COS_BUCKET=ibmdotcom-react-experimental
        - PACKAGE_NAME=react
        - PACKAGE_FOLDER=react
        - BUILD_TYPE=storybook-experimental
      before_install:
        - ./.travis/deploy_preview_before_install.sh ${TRAVIS_PULL_REQUEST} ${TRAVIS_REPO_SLUG} ${PACKAGE_NAME} ${COS_ACCESS_KEY_ID} ${COS_SECRET_ACCESS_KEY} || travis_terminate 0
      script:
        - ./.travis/deploy_preview_build.sh ${BUILD_TYPE} ${PACKAGE_FOLDER} ${COS_BUCKET} ${TRAVIS_PULL_REQUEST} ${PREVIEW_DOMAIN}
      after_success:
        - "node ./.travis/deploy_preview_comment.js ${GITHUB_TOKEN} 'React - Experimental' ${COS_BUCKET} ${PREVIEW_DOMAIN} ${TRAVIS_PULL_REQUEST} ${TRAVIS_PULL_REQUEST_SHA} ${TRAVIS_REPO_SLUG}"
    - stage: deploy-preview-services
      env:
        - COS_BUCKET=ibmdotcom-services
        - PACKAGE_NAME=services
        - PACKAGE_FOLDER=services
        - BUILD_TYPE=jsdoc
      before_install:
        - ./.travis/deploy_preview_before_install.sh ${TRAVIS_PULL_REQUEST} ${TRAVIS_REPO_SLUG} ${PACKAGE_NAME} ${COS_ACCESS_KEY_ID} ${COS_SECRET_ACCESS_KEY} || travis_terminate 0
      script:
        - ./.travis/deploy_preview_build.sh ${BUILD_TYPE} ${PACKAGE_FOLDER} ${COS_BUCKET} ${TRAVIS_PULL_REQUEST} ${PREVIEW_DOMAIN}
      after_success:
        - "node ./.travis/deploy_preview_comment.js ${GITHUB_TOKEN} 'Services' ${COS_BUCKET} ${PREVIEW_DOMAIN} ${TRAVIS_PULL_REQUEST} ${TRAVIS_PULL_REQUEST_SHA} ${TRAVIS_REPO_SLUG}"
    - stage: deploy-preview-utilities
      env:
        - COS_BUCKET=ibmdotcom-utilities
        - PACKAGE_NAME=utilities
        - PACKAGE_FOLDER=utilities
        - BUILD_TYPE=jsdoc
      before_install:
        - ./.travis/deploy_preview_before_install.sh ${TRAVIS_PULL_REQUEST} ${TRAVIS_REPO_SLUG} ${PACKAGE_NAME} ${COS_ACCESS_KEY_ID} ${COS_SECRET_ACCESS_KEY} || travis_terminate 0
      script:
        - ./.travis/deploy_preview_build.sh ${BUILD_TYPE} ${PACKAGE_FOLDER} ${COS_BUCKET} ${TRAVIS_PULL_REQUEST} ${PREVIEW_DOMAIN}
      after_success:
        - "node ./.travis/deploy_preview_comment.js ${GITHUB_TOKEN} 'Utilities' ${COS_BUCKET} ${PREVIEW_DOMAIN} ${TRAVIS_PULL_REQUEST} ${TRAVIS_PULL_REQUEST_SHA} ${TRAVIS_REPO_SLUG}"
    - stage: deploy-preview-vanilla
      env:
        - COS_BUCKET=ibmdotcom-vanilla
        - PACKAGE_NAME=vanilla
        - PACKAGE_FOLDER=vanilla
        - BUILD_TYPE=storybook
      before_install:
        - ./.travis/deploy_preview_before_install.sh ${TRAVIS_PULL_REQUEST} ${TRAVIS_REPO_SLUG} ${PACKAGE_NAME} ${COS_ACCESS_KEY_ID} ${COS_SECRET_ACCESS_KEY} || travis_terminate 0
      script:
        - ./.travis/deploy_preview_build.sh ${BUILD_TYPE} ${PACKAGE_FOLDER} ${COS_BUCKET} ${TRAVIS_PULL_REQUEST} ${PREVIEW_DOMAIN}
      after_success:
        - "node ./.travis/deploy_preview_comment.js ${GITHUB_TOKEN} 'Vanilla' ${COS_BUCKET} ${PREVIEW_DOMAIN} ${TRAVIS_PULL_REQUEST} ${TRAVIS_PULL_REQUEST_SHA} ${TRAVIS_REPO_SLUG}"
stages:
  - name: deploy-preview-expressive
    if: type = pull_request
  - name: deploy-preview-patterns-react
    if: type = pull_request
  - name: deploy-preview-patterns-react-experimental
    if: type = pull_request
  - name: deploy-preview-react
    if: type = pull_request
  - name: deploy-preview-react-experimental
    if: type = pull_request
  - name: deploy-preview-services
    if: type = pull_request
  - name: deploy-preview-utilities
    if: type = pull_request
  - name: deploy-preview-vanilla
    if: type = pull_request
